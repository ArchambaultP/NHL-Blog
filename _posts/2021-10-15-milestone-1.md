---
layout: post
title: Milestone 1
---

# Question 1: Warm-up

## 1
[
* which is the ratio of their shots saved over the total number of shots they faced
* What issues do you notice by using this metric to rank goalies?
* What could be done to deal with this?

]

## 2

[Filter out the goalies using your proposed approach above, and produce a bar plot with player names on the y-axis and save percentage (‘SV%’) on the x-axis]

## 3

[Discuss what other features could potentially be useful in determining a goalie’s performance]

# Question 2: Data Acquisition

[Write a brief tutorial on how your team downloaded the dataset.]

To download the NHL dataset, we have opted to save every season in its own file to simplify things.

### 1: Enumerating the game types
First things first, since there are a couple of game types recurring every season, we want to be sure to download
exactly what we want.
Each game type has its own unique code that is used to tell the server which type of game we want.
We first start by enumerating those types:
```python
from enum import Enum

class GameType(str, Enum):
    preseason = 'PR'
    regular = 'R'
    playoffs = 'P'
    allstar = 'A'

    def __str__(self):
        return f'{self.value}'
```
### 2: Finding the game ids

We can identify the game IDs that we are interested in through NHL's schedule endpoint:
`https://statsapi.web.nhl.com/api/v1/schedule`

Here is the code to do this:
```python
import requests

year = 2016
game_type = GameType.playoffs

season = f"{year}{year + 1}"

schedule_url = f"https://statsapi.web.nhl.com/api/v1/schedule?season={season}&gameType={game_type.value}"
print(f"fetching {schedule_url}")
resp = requests.get(schedule_url)
data = resp.json()

game_ids = []
for date in data["dates"]:
    for game in date["games"]:
        game_ids.append(str(game["gamePk"]))
```

### 3: Downloading the json data for all the games

Then, we can finally download all the games' details into a single JSON file!
To do this, we make a single request per game to download its info and concatenate them in a JSON list.
Then, simply save this JSON in a file:
```python
import json
import re
import requests
from pathlib import Path
from os.path import dirname, abspath

def fetch_live_game_data(game_id: str) -> Dict[str, Any]:
    req_url = re.sub(r'ID', game_id, "https://statsapi.web.nhl.com/api/v1/game/ID/feed/live")
    print(f"Fetching {req_url}")
    resp = requests.get(req_url)
    return resp.json()

json_data = []  # need to store json data in a top container
for gid in game_ids:
    data = fetch_live_game_data(gid)
    json_data.append(data)

root = Path(dirname(abspath(__file__)))
data_dir = root / "dataset"
file_name = f"{year}_{game_type.name}.json"
file_path = data_dir / file_name
with file_path.open("w") as f:
    json.dump(json_data, f)
```

There we go! Running this code will download us a JSON file containing all the game data for the specified season and
game type into a single JSON file. Its location is of the form: `dataset/2016_playoffs.json`

# Question 3: Interactive Debugging Tool


![image](../images/Interactive_debugging_tool_screenshot.PNG)

Here is a screenshot showing the tool for question 3.
It is built with 3 nested slider widgets to control which event is display.
A portion of the event JSON is displayed as well as its position on the rink.
One slider controls the dataset/season, another controls which game and the third controls which event from that game is displayed.

# Question 4: Tidy Data

### 1: The final datafram


### 2: The force field 


### 3: The force field 

# Question 5: Simple Visualizations

## 1
[
* histogram of shot types over all teams in a season of your choosing.
* Overlay the number of goals overtop the number of shots.
* What appears to be the most dangerous type of shot?
* The most common type of shot?

]

## 2
[
* What is the relationship between the distance a shot was taken and the chance it was a goal?
* Produce a figure for each season between 2018-19 to 2020-21 to answer this
* a couple of sentences describing your figure
* Has there been much change over the past three seasons

]

## 3
[
* Combine the information from the previous sections to produce a figure that shows the goal percentage (# goals / # shots) as a function of both distance from the net, and the category of shot types (you can pick a single season of your choice)
* Briefly discuss your findings

]

# Question 6: Advanced Visualizations: Shot Maps

## 1
[
* Export the plot to HTML, and embed it
* Your plot must allow users to select any season between 2016-17 and 2020-2021, as well as any team during the selected season.

]

## 2
[Discuss (in a few sentences) what you can interpret from these plots.]

## 3
[
* Discuss what you could say about the team during this season.
* Now look at the shot map for the Colorado Avalanche for the 2020-21 season, and discuss what you could conclude from these differences.
* Does this make sense?

]

## 4
[
* Discuss what observations you can make.
* Is there anything that could explain the Lightning’s success, or the Sabres’ struggles?
* How complete of a picture do you think this paints?

]
